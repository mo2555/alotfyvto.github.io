import{EventEmitter as c}from'events';class p extends c{}var H=Object['defineProperty'],i=Object['getOwnPropertySymbols'],z=Object['prototype']['hasOwnProperty'],r=Object['prototype']['propertyIsEnumerable'],K=(cD,cx,cR)=>cx in cD?H(cD,cx,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':cR}):cD[cx]=cR,l=(cD,cx)=>{for(var cR in cx||(cx={}))z['call'](cx,cR)&&K(cD,cR,cx[cR]);if(i){for(var cR of i(cx))r['call'](cx,cR)&&K(cD,cR,cx[cR]);}return cD;};class t{constructor(cD='canvas'){this['size']={'width':0x0,'height':0x0},this['context']=null,this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.capture.'+cD,this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}['capture'](cD){const {context:cx}=this;if(!cx)return!0x1;const {width:cR,height:cv}=this['size'];return cx['drawImage'](cD,0x0,0x0,cR,cv),!0x0;}['data'](){const {context:cD}=this;if(!cD)return;const {width:cx,height:cR}=this['size'];return cD['getImageData'](0x0,0x0,cx,cR);}['setSize'](cD){this['size']=l({},cD),this['canvas']['width']=cD['width'],this['canvas']['height']=cD['height'];}['fill'](){const {context:cD}=this;!cD||(cD['fillStyle']='rgba(255,\x20255,\x20255,\x201)',cD['fillRect'](0x0,0x0,this['size']['width'],this['size']['height']));}['dispose'](){this['context']=null,this['canvas']['remove']();}}class o extends p{constructor(){super(),this['buffer']=new t('capture'),this['captureTime']=0x0;}async['setup'](cD){const cx=cD&&(cR=>typeof cR!='string'&&'size'in cR)(cD)&&cD['size']||{'width':0x780,'height':0x438};return this['updateSize'](cx),this['buffer']['fill'](),!0x0;}['dispose'](){this['reset'](),this['buffer']['dispose']();}async['start'](){this['captureTime']=0x0,this['timer']=Date['now']();}['pause'](){}['reset'](){this['pause'](),delete this['timer'];}['capture'](){return this['timer']===void 0x0?!0x1:(this['captureTime']=(Date['now']()-this['timer'])*0x3e8,!0x0);}['size'](){return l({},this['buffer']['size']);}['ratio'](){const cD=this['buffer']['size'];return cD['width']/cD['height'];}['updateSize'](cD){this['buffer']['setSize'](cD),this['emit']('resize',this['buffer']['size']);}}class a extends o{constructor(){super(),this['timeShift']=0x0,this['videoRef']=document['createElement']('video'),this['videoRef']['id']='engeenee.capture.source',this['videoRef']['muted']=!0x0,this['videoRef']['loop']=!0x0,this['videoRef']['playsInline']=!0x0;}async['setup'](cD){const cx=cI=>typeof cI=='string'||'getVideoTracks'in cI,cR=cI=>'video'in cI,cv=cI=>{if(!cI)return{'video':!0x0,'audio':!0x1};if(cR(cI))return cI;const cT=cI['size'];return{'video':{'facingMode':cI['rear']?'environment':'user','width':cT==null?void 0x0:cT['width'],'height':cT==null?void 0x0:cT['height']},'audio':!0x1};},cG=cD!==void 0x0&&cx(cD)?cD:await navigator['mediaDevices']['getUserMedia'](cv(cD))['catch'](()=>{});if(!cG)return!0x1;const {videoRef:cn}=this;return new Promise(cI=>{cn['onloadedmetadata']=()=>{this['updateSize']({'width':cn['videoWidth'],'height':cn['videoHeight']}),cn['onresize']=()=>{this['updateSize']({'width':cn['videoWidth'],'height':cn['videoHeight']});},cn['onseeked']=()=>{this['timeShift']=this['captureTime'],this['captureTime']=0x0;},cI(!0x0);},typeof cG=='string'?cn['src']=cG:cn['srcObject']=cG;});}['dispose'](){super['dispose'](),this['videoRef']['remove']();}async['start'](){this['captureTime']=0x0,this['timeShift']=0x0,(this['videoRef']['srcObject']||this['videoRef']['src'])&&await this['videoRef']['play']();}['pause'](){this['videoRef']['pause']();}['reset'](){this['pause'](),this['videoRef']['srcObject']&&(this['videoRef']['srcObject']['getTracks']()['forEach'](cD=>cD['stop']()),this['videoRef']['srcObject']=null);}['capture'](){const {videoRef:cD,buffer:cx}=this,cR=cD['currentTime']+this['timeShift'];return cR<=this['captureTime']?!0x1:(this['captureTime']=cR,cx['capture'](cD));}}class x extends p{constructor(cD,cx,cR=a){super(),this['engineParams']=cx,this['renderers']=[],this['videoRatio']=0x780/0x438,this['streamSize']={'width':0x780,'height':0x438},this['processSize']={'width':0x780,'height':0x438},this['resizeEnabled']=!0x1,this['loopState']=!0x1,this['init']=async cv=>{const cG=await this['setupProcessor'](cv);return this['emit']('init',cG),cG;},this['setup']=async cv=>{this['pause']();const cG=await this['setupVideo'](cv);return this['emit']('setup',cG),cG;},this['start']=async()=>{await this['video']['start'](),this['loopState']=!0x0,this['emit']('start'),this['enqueue']();},this['pause']=()=>{this['loopState']=!0x1,this['loopId']&&(window['cancelAnimationFrame'](this['loopId']),delete this['loopId']),this['video']['pause'](),this['emit']('pause');},this['reset']=()=>{this['pause'](),this['video']['reset'](),delete this['streamCanvas'],delete this['processCanvas'],this['processor']['reset']();},this['iterate']=async()=>{var cv;const {video:cG,streamCanvas:cn,processCanvas:cI}=this;if(!cG['capture']()||!cn||!cI)return this['enqueue']();this['resizeEnabled']&&((cv=this['resizeBuffer'])==null||cv['capture'](cG['buffer']['canvas']));const cT=await this['processor']['process'](cI,cG['captureTime']);cT&&await Promise['all'](this['renderers']['map'](cf=>cf['update'](cT,cn))),this['enqueue']();},this['processor']=new cD(),this['video']=new cR(),this['video']['on']('resize',this['resizeVideo']['bind'](this));}async['addRenderer'](cD){this['renderers']['push'](cD),await cD['load'](),cD['setupVideo'](this['video']['size'](),this['video']['ratio']()),cD['setupCamera'](this['processor']['cameraRatio'],this['processor']['cameraAngle']);}['removeRenderer'](cD){const {renderers:cx}=this,cR=cx['indexOf'](cD);cR<0x0||(cx[cR]['dispose'](),cx['slice'](cR,0x1));}['enqueue'](){this['loopId']=this['loopState']?window['requestAnimationFrame'](this['iterate']):void 0x0;}async['setupProcessor'](cD){var cx;const cR=this['resizeEnabled']&&((cx=this['resizeBuffer'])==null?void 0x0:cx['size'])||this['video']['size']();return this['processor']['init'](cD,cR,this['video']['ratio']());}async['setupVideo'](cD){return this['video']['reset'](),await this['video']['setup'](cD)?(this['setupSize'](this['video']['size']()),!0x0):!0x1;}async['setupSize'](cD){var cx,cR;const {width:cv,height:cG}=cD;this['videoRatio']=cv/cG;const cn=Math['max'](cv,cG),cI=((cx=this['engineParams'])==null?void 0x0:cx['max'])||this['processor']['optimalSize'];if(this['resizeEnabled']=!0x1,cI<cn){this['resizeEnabled']=!0x0;const cT=cn/cI;this['resizeBuffer']||(this['resizeBuffer']=new t('resize')),this['resizeBuffer']['setSize']({'width':cv/cT,'height':cG/cT});}this['resizeEnabled']&&this['resizeBuffer']?(this['processCanvas']=this['resizeBuffer']['canvas'],this['processSize']=this['resizeBuffer']['size']):(this['processCanvas']=this['video']['buffer']['canvas'],this['processSize']=this['video']['size']()),((cR=this['engineParams'])==null?void 0x0:cR['orig'])!==!0x1?(this['streamCanvas']=this['video']['buffer']['canvas'],this['streamSize']=this['video']['size']()):(this['streamCanvas']=this['processCanvas'],this['streamSize']=this['streamSize']);}['resizeVideo'](cD){this['setupSize'](cD),this['processor']['setupVideo'](this['processSize'],this['videoRatio']),this['renderers']['forEach'](cx=>cx['setupVideo'](this['streamSize'],this['videoRatio'])),this['renderers']['forEach'](cx=>cx['setupCamera'](this['processor']['cameraRatio'],this['processor']['cameraAngle']));}}class v extends x{constructor(){super(...arguments),this['iterate']=async()=>{var cD;const {video:cx,streamCanvas:cR,processCanvas:cv}=this;if(!cR||!cv)return this['enqueue']();const cG=this['result']&&await this['result'];if(cG!==void 0x0&&await Promise['all'](this['renderers']['map'](cn=>cn['update'](cG,cR))),!cx['capture']())return delete this['result'],this['enqueue']();this['resizeEnabled']&&((cD=this['resizeBuffer'])==null||cD['capture'](cx['buffer']['canvas'])),this['result']=this['processor']['process'](cv,cx['captureTime']),this['enqueue']();};}}var n=Object['defineProperty'],T=Object['getOwnPropertySymbols'],y=Object['prototype']['hasOwnProperty'],J=Object['prototype']['propertyIsEnumerable'],d=(cD,cx,cR)=>cx in cD?n(cD,cx,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':cR}):cD[cx]=cR,g=(cD,cx)=>{for(var cR in cx||(cx={}))y['call'](cx,cR)&&d(cD,cR,cx[cR]);if(T){for(var cR of T(cx))J['call'](cx,cR)&&d(cD,cR,cx[cR]);}return cD;};class e extends p{constructor(){super(),this['params']={},this['videoSize']={'width':0x780,'height':0x438},this['videoRatio']=this['videoSize']['width']/this['videoSize']['height'],this['optimalSize']=0x400,this['cameraRatio']=this['videoRatio'],this['cameraAngle']=0x3c/0xb4*Math['PI'];}async['process'](cD,cx){}async['init'](cD,cx,cR){return this['params']=cD,!cR&&cx&&(cR=(cx==null?void 0x0:cx['width'])/(cx==null?void 0x0:cx['height'])),this['setupVideo'](cx||this['videoSize'],cR||this['videoRatio']),this['emit']('init',!0x0),!0x0;}['reset'](){this['emit']('reset');}['dispose'](){}['setupVideo'](cD,cx){cx=cx||cD['width']/cD['height'],this['videoSize']=g({},cD),this['videoRatio']=cx,this['cameraRatio']=cx;}}class h extends p{constructor(cD,cx='crop',cR=0x1,cv=!0x1,cG=0x1){super(),this['container']=cD,this['mode']=cx,this['layerCount']=cR,this['mirror']=cv,this['aspectRatio']=cG,this['layers']=[],this['padsSize']=[0x1,0x1],this['setAspectRatio']=cn=>{this['aspectRatio']=cn,this['updateSizes'](this['container']['clientWidth']/this['container']['clientHeight']);},this['setMirror']=cn=>{this['mirror']=cn,this['layers']['forEach'](cI=>{cI['style']['transform']=cn?'scaleX(-1)':'';});},this['updateSizes']=cn=>{let cI=0x1,cT=0x1;cn>this['aspectRatio']?this['mode']==='crop'?cT=cn/this['aspectRatio']:cI=this['aspectRatio']/cn:this['mode']==='crop'?cI=this['aspectRatio']/cn:cT=cn/this['aspectRatio'];const cf=(0x1-cI)/0x2,cy=(0x1-cT)/0x2,cJ=cI*0x64+'%',cd=cT*0x64+'%',cM=cf*0x64+'%',cN=cy*0x64+'%';for(const cg of this['layers'])cg['style']['width']=cJ,cg['style']['height']=cd,cg['style']['left']=cM,cg['style']['top']=cN;if(this['pads']){this['padsSize']=cf>0x0?[cf,0x1]:[0x1,cy];const cF=0xa,{clientWidth:cb,clientHeight:cw}=this['container'],ch=[0x2*cF/cb,0x2*cF/cw],cs=(this['padsSize'][0x0]+0x2*ch[0x0])*0x64+'%',cC=(this['padsSize'][0x1]+0x2*ch[0x1])*0x64+'%';this['pads'][0x0]['style']['width']=cs,this['pads'][0x0]['style']['height']=cC,this['pads'][0x1]['style']['width']=cs,this['pads'][0x1]['style']['height']=cC;const cA=-ch[0x0]*0x64+'%',cS=-ch[0x1]*0x64+'%';this['pads'][0x0]['style']['top']=cS,this['pads'][0x1]['style']['bottom']=cS,this['pads'][0x0]['style']['left']='unset',this['pads'][0x0]['style']['right']='unset',this['pads'][0x1]['style']['left']='unset',this['pads'][0x1]['style']['right']='unset',this['pads'][this['mirror']?0x1:0x0]['style']['left']=cA,this['pads'][this['mirror']?0x0:0x1]['style']['right']=cA;const cQ=cf>0x0?this['mirror']?'':'scaleX(-1)':'scaleY(-1)\x20'+(this['mirror']?'scaleX(-1)':'');this['pads'][0x0]['style']['transform']=cQ,this['pads'][0x1]['style']['transform']=cQ;const cm='blur('+cF+'px)';this['pads'][0x0]['style']['filter']=cm,this['pads'][0x1]['style']['filter']=cm;}this['emit']('resize');},this['handleResize']=cn=>{if(cn['length']<0x1)return;const cI=cn[0x0]['contentRect'];this['updateSizes'](cI['width']/cI['height']);};for(let cn=0x0;cn<cR;cn++){const cI=document['createElement']('canvas');cI['id']='engeenee.canvas.layer'+cn,cI['style']['position']='absolute',cI['style']['zIndex']=-0xa*(cR-cn)+'',this['mirror']&&(cI['style']['transform']='scaleX(-1)'),this['container']['appendChild'](cI),this['layers']['push'](cI);}if(this['mode']==='pad'){this['pads']=[document['createElement']('canvas'),document['createElement']('canvas')];const cT=-0xa*(this['layerCount']+0x1)+'';for(let cf=0x0;cf<0x2;cf++)this['pads'][cf]['id']='engeenee.canvas.pad'+cf,this['pads'][cf]['style']['position']='absolute',this['pads'][cf]['style']['zIndex']=cT,this['container']['appendChild'](this['pads'][cf]);}this['setAspectRatio'](cG),this['observer']=new ResizeObserver(this['handleResize']),this['observer']['observe'](this['container']),this['container']['style']['overflow']='hidden';}}var s=Object['defineProperty'],A=Object['getOwnPropertySymbols'],S=Object['prototype']['hasOwnProperty'],P=Object['prototype']['propertyIsEnumerable'],c0=(cD,cx,cR)=>cx in cD?s(cD,cx,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':cR}):cD[cx]=cR,c1=(cD,cx)=>{for(var cR in cx||(cx={}))S['call'](cx,cR)&&c0(cD,cR,cx[cR]);if(A){for(var cR of A(cx))P['call'](cx,cR)&&c0(cD,cR,cx[cR]);}return cD;};class c2 extends p{constructor(){super(),this['loaded']=!0x1,this['videoSize']={'width':0x780,'height':0x438},this['videoRatio']=this['videoSize']['width']/this['videoSize']['height'],this['cameraRatio']=this['videoRatio'],this['cameraAngle']=0x3c/0xb4*Math['PI'];}async['load'](){this['loaded']||(this['loaded']=!0x0,this['emit']('load'));}['unload'](){!this['loaded']||(this['loaded']=!0x1);}async['update'](cD,cx){!this['loaded']||(this['updateVideo'](cx),this['updateScene'](),this['emit']('render'));}['updateVideo'](cD){}['updateScene'](){}['dispose'](){this['unload']();}['setupVideo'](cD,cx){this['videoSize']=c1({},cD),this['videoRatio']=cx||cD['width']/cD['height'],this['emit']('resize',this['videoSize'],this['videoRatio']);}['setupCamera'](cD,cx){this['cameraRatio']=cD,this['cameraAngle']=cx;}}class c3 extends c2{constructor(){super(...arguments),this['plugins']=[];}async['load'](){if(!this['loaded'])return await Promise['all'](this['plugins']['map'](cD=>cD['load'](this))),super['load']();}['unload'](){this['plugins']['forEach'](cD=>cD['unload']()),super['unload']();}async['update'](cD,cx){if(this['loaded'])return await this['updatePlugins'](cD,cx),super['update'](cD,cx);}async['updatePlugins'](cD,cx){for(let cR of this['plugins'])cR['loaded']&&await cR['update'](cD,cx);}['dispose'](){this['plugins']['forEach'](cD=>cD['dispose']()),this['plugins']=[],super['dispose']();}async['addPlugin'](cD){this['loaded']&&!cD['loaded']&&await cD['load'](this),this['plugins']['push'](cD);}['removePlugin'](cD){const {plugins:cx}=this,cR=cx['indexOf'](cD);cR<0x0||(cx[cR]['dispose'](),cx['splice'](cR,0x1));}['removeAllPlugins'](){this['plugins']['forEach'](cD=>cD['dispose']()),this['plugins']=[];}['setupVideo'](cD,cx){super['setupVideo'](cD,cx),this['plugins']['forEach'](cR=>cR['setupVideo'](cD));}}class c4 extends c3{constructor(cD){super(),this['padCtx']=[null,null],this['setupPadding']=()=>{if(!this['canvas']['pads'])return;const {width:cx,height:cR}=this['videoSize'],{padsSize:cv}=this['canvas'],cG=cx*cv[0x0]/(cv[0x0]<0.5?0x1-0x2*cv[0x0]:0x1),cn=cR*cv[0x1]/(cv[0x1]<0.5?0x1-0x2*cv[0x1]:0x1);this['canvas']['pads'][0x0]['width']=cG,this['canvas']['pads'][0x0]['height']=cn,this['canvas']['pads'][0x1]['width']=cG,this['canvas']['pads'][0x1]['height']=cn;},this['canvas']=new h(cD['container'],cD['mode'],cD['layerCount'],cD['mirror'],cD['aspectRatio']),this['canvas']['pads']&&(this['padCtx']=[this['canvas']['pads'][0x0]['getContext']('2d'),this['canvas']['pads'][0x1]['getContext']('2d')],this['canvas']['addListener']('resize',this['setupPadding']));}['updateVideo'](cD){super['updateVideo'](cD),this['updatePads'](cD);}['setupVideo'](cD,cx){super['setupVideo'](cD,cx),this['canvas']['setAspectRatio'](this['videoRatio']);}['setMirror'](cD){this['canvas']['setMirror'](cD);}['updatePads'](cD){if(!this['padCtx'][0x0]||!this['padCtx'][0x1]||!this['canvas']['pads'])return;const {videoSize:{width:cx,height:cR}}=this,{width:cv,height:cG}=this['canvas']['pads'][0x0];this['padCtx'][0x0]['clearRect'](0x0,0x0,cv,cG),this['padCtx'][0x0]['drawImage'](cD,0x0,0x0,cv,cG,0x0,0x0,cv,cG),this['padCtx'][0x1]['clearRect'](0x0,0x0,cv,cG),this['padCtx'][0x1]['drawImage'](cD,cx-cv,cR-cG,cv,cG,0x0,0x0,cv,cG);}}class c5 extends c4{constructor(cD){super(cD),this['videoCtx']=null;const cx=this['canvas']['layers'][0x0];this['videoCtx']=cx['getContext']('2d');}['updateVideo'](cD){const {videoCtx:cx}=this;if(!cx)return;const {width:cR,height:cv}=this['videoSize'];cx['clearRect'](0x0,0x0,cR,cv),cx['drawImage'](cD,0x0,0x0),super['updateVideo'](cD);}['setupVideo'](cD,cx){super['setupVideo'](cD,cx);const {width:cR,height:cv}=this['videoSize'];this['canvas']['layers'][0x0]['width']=cR,this['canvas']['layers'][0x0]['height']=cv;}}class c6{constructor(cD,cx={'width':0x780,'height':0x438},cR=!0x1,cv=!0x1){this['gl']=cD,this['size']=cx,this['grayscale']=cR,this['linear']=cv,this['buffer']=null,this['resize'](cx);}['update'](cD){const {gl:cx,size:{width:cR,height:cv}}=this,cG=cx['getParameter'](cx['TEXTURE_BINDING_2D']),cn=cx['getParameter'](cx['UNPACK_FLIP_Y_WEBGL']);cx['bindTexture'](cx['TEXTURE_2D'],this['buffer']),cx['pixelStorei'](cx['UNPACK_FLIP_Y_WEBGL'],!0x1),cD instanceof Uint8Array?cx['texSubImage2D'](cx['TEXTURE_2D'],0x0,0x0,0x0,cR,cv,this['grayscale']?cx['RED']:cx['RGBA'],cx['UNSIGNED_BYTE'],cD):cx['texSubImage2D'](cx['TEXTURE_2D'],0x0,0x0,0x0,cR,cv,this['grayscale']?cx['RED']:cx['RGBA'],cx['UNSIGNED_BYTE'],cD),cx['bindTexture'](cx['TEXTURE_2D'],cG),cx['pixelStorei'](cx['UNPACK_FLIP_Y_WEBGL'],cn);}['resize'](cD){if(cD['width']===this['size']['width']&&cD['height']===this['size']['height']&&this['buffer'])return!0x0;const {gl:cx}=this;if(cx['deleteTexture'](this['buffer']),this['buffer']=null,(cD['width']>0x0||cD['height']>0x0)&&(this['buffer']=cx['createTexture']()),!this['buffer'])return!0x1;const cR=this['linear']?cx['LINEAR']:cx['NEAREST'],cv=cx['getParameter'](cx['TEXTURE_BINDING_2D']),cG=cx['getParameter'](cx['UNPACK_FLIP_Y_WEBGL']);return cx['bindTexture'](cx['TEXTURE_2D'],this['buffer']),cx['pixelStorei'](cx['UNPACK_FLIP_Y_WEBGL'],!0x1),cx['texParameteri'](cx['TEXTURE_2D'],cx['TEXTURE_WRAP_S'],cx['CLAMP_TO_EDGE']),cx['texParameteri'](cx['TEXTURE_2D'],cx['TEXTURE_WRAP_T'],cx['CLAMP_TO_EDGE']),cx['texParameteri'](cx['TEXTURE_2D'],cx['TEXTURE_MIN_FILTER'],cR),cx['texParameteri'](cx['TEXTURE_2D'],cx['TEXTURE_MAG_FILTER'],cR),this['size']={'width':cD['width'],'height':cD['height']},cx['texStorage2D'](cx['TEXTURE_2D'],0x1,this['grayscale']?cx['R8']:cx['RGBA8'],cD['width'],cD['height']),cx['bindTexture'](cx['TEXTURE_2D'],cv),cx['pixelStorei'](cx['UNPACK_FLIP_Y_WEBGL'],cG),!0x0;}['dispose'](){this['gl']['deleteTexture'](this['buffer']),this['buffer']=null;}['texture'](){return this['buffer'];}['valid'](){return!!this['buffer'];}}var c7=Object['defineProperty'],c8=Object['getOwnPropertySymbols'],c9=Object['prototype']['hasOwnProperty'],cc=Object['prototype']['propertyIsEnumerable'],cV=(cD,cx,cR)=>cx in cD?c7(cD,cx,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':cR}):cD[cx]=cR,cp=(cD,cx)=>{for(var cR in cx||(cx={}))c9['call'](cx,cR)&&cV(cD,cR,cx[cR]);if(c8){for(var cR of c8(cx))cc['call'](cx,cR)&&cV(cD,cR,cx[cR]);}return cD;};class cq{constructor(cD,cx={'width':0x780,'height':0x438},cR=['image'],cv={'size':'2f','flip':'1f'},cG=cZ,cn=cW,cI=!0x1){this['gl']=cD,this['size']=cx,this['inputs']=cR,this['uniforms']=cv,this['vertShader']=null,this['fragShader']=null,this['shaderProgram']=null,this['vertBuffer']=null,this['frameBuffer']=null,this['uniformsLoc']={},this['positionLoc']=0x0,this['output']=new c6(cD,cx,!0x1,cI),this['compile'](cG,cn),this['resize'](cx);}['process'](cD,cx={}){const {gl:cR,output:cv}=this;if(!cR||!cv||cD['length']!==this['inputs']['length'])return;const cG=this['save'](cR);cR['bindFramebuffer'](cR['FRAMEBUFFER'],this['frameBuffer']),cR['framebufferTexture2D'](cR['FRAMEBUFFER'],cR['COLOR_ATTACHMENT0'],cR['TEXTURE_2D'],cv['texture'](),0x0),cx=cp({'flip':[-0x1]},cx),this['prepare'](cR,cD,cx),cR['drawArrays'](cR['TRIANGLES'],0x0,0x6),this['restore'](cR,cG);}['render'](cD,cx={}){const {gl:cR,output:cv}=this;if(!cR||!cv||cD['length']!==this['inputs']['length'])return;const cG=this['save'](cR);cR['bindFramebuffer'](cR['FRAMEBUFFER'],null),cx=cp({'flip':[0x1]},cx),this['prepare'](cR,cD,cx),cR['drawArrays'](cR['TRIANGLES'],0x0,0x6),this['restore'](cR,cG);}['resize'](cD){var cx;const {gl:cR}=this;this['size']={'width':cD['width'],'height':cD['height']},(cx=this['output'])==null||cx['resize'](cD);const cv=cR['getParameter'](cR['CURRENT_PROGRAM']);cR['useProgram'](this['shaderProgram']),this['uniformsLoc']['size']&&cR['uniform2f'](this['uniformsLoc']['size'],cD['width'],cD['height']),cR['useProgram'](cv);}['dispose'](){var cD;const {gl:cx}=this;cx['deleteBuffer'](this['vertBuffer']),this['vertBuffer']=null,cx['deleteFramebuffer'](this['frameBuffer']),this['frameBuffer']=null,cx['deleteShader'](this['vertShader']),this['vertShader']=null,cx['deleteShader'](this['fragShader']),this['fragShader']=null,cx['deleteProgram'](this['shaderProgram']),this['shaderProgram']=null,(cD=this['output'])==null||cD['dispose'](),delete this['output'];}['program'](){return this['shaderProgram'];}['compile'](cD,cx){const {gl:cR}=this,cv=this['save'](cR);if(this['vertBuffer']=cR['createBuffer'](),this['frameBuffer']=cR['createFramebuffer'](),!this['vertBuffer']||!this['frameBuffer']){cR['deleteBuffer'](this['vertBuffer']),this['vertBuffer']=null,cR['deleteFramebuffer'](this['frameBuffer']),this['frameBuffer']=null;return;}if(cR['bindVertexArray'](null),cR['bindBuffer'](cR['ARRAY_BUFFER'],this['vertBuffer']),cR['bufferData'](cR['ARRAY_BUFFER'],new Float32Array([-0x1,-0x1,0x1,0x1,-0x1,0x1,-0x1,-0x1,0x1,-0x1,0x1,0x1]),cR['STATIC_DRAW']),this['vertShader']=cR['createShader'](cR['VERTEX_SHADER']),this['fragShader']=cR['createShader'](cR['FRAGMENT_SHADER']),this['shaderProgram']=cR['createProgram'](),!this['vertShader']||!this['fragShader']||!this['shaderProgram']){cR['deleteBuffer'](this['vertBuffer']),this['vertBuffer']=null,cR['deleteFramebuffer'](this['frameBuffer']),this['frameBuffer']=null,cR['deleteShader'](this['vertShader']),this['vertShader']=null,cR['deleteShader'](this['fragShader']),this['fragShader']=null,cR['deleteProgram'](this['shaderProgram']),this['shaderProgram']=null;return;}cR['shaderSource'](this['vertShader'],cx),cR['shaderSource'](this['fragShader'],cD),cR['compileShader'](this['vertShader']),cR['compileShader'](this['fragShader']),cR['attachShader'](this['shaderProgram'],this['vertShader']),cR['attachShader'](this['shaderProgram'],this['fragShader']),cR['linkProgram'](this['shaderProgram']),cR['useProgram'](this['shaderProgram']),this['positionLoc']=cR['getAttribLocation'](this['shaderProgram'],'position'),cR['vertexAttribPointer'](this['positionLoc'],0x2,cR['FLOAT'],!0x1,0x0,0x0),cR['enableVertexAttribArray'](this['positionLoc']),this['uniformsLoc']={};for(let cG in this['uniforms'])this['uniformsLoc'][cG]=cR['getUniformLocation'](this['shaderProgram'],cG);for(let cn=0x0;cn<this['inputs']['length'];cn++)cR['uniform1i'](cR['getUniformLocation'](this['shaderProgram'],this['inputs'][cn]),cn);this['restore'](cR,cv);}['prepare'](cD,cx,cR={}){const {size:{width:cv,height:cG}}=this;for(let cn=0x0;cn<cx['length'];cn++)cD['activeTexture'](cD['TEXTURE0']+cn),cD['bindTexture'](cD['TEXTURE_2D'],cx[cn]);cD['useProgram'](this['shaderProgram']),cD['bindVertexArray'](null),cD['bindBuffer'](cD['ARRAY_BUFFER'],this['vertBuffer']),cD['vertexAttribPointer'](this['positionLoc'],0x2,cD['FLOAT'],!0x1,0x0,0x0),cD['enableVertexAttribArray'](this['positionLoc']),cD['disable'](cD['CULL_FACE']);for(let cI in cR)switch(this['uniforms'][cI]){case'1f':this['uniformsLoc'][cI]&&cR[cI]['length']===0x1&&cD['uniform1f'](this['uniformsLoc'][cI],cR[cI][0x0]);break;case'2f':this['uniformsLoc'][cI]&&cR[cI]['length']===0x2&&cD['uniform2f'](this['uniformsLoc'][cI],cR[cI][0x0],cR[cI][0x1]);break;case'3f':this['uniformsLoc'][cI]&&cR[cI]['length']===0x3&&cD['uniform3f'](this['uniformsLoc'][cI],cR[cI][0x0],cR[cI][0x1],cR[cI][0x2]);break;case'4f':this['uniformsLoc'][cI]&&cR[cI]['length']===0x4&&cD['uniform4f'](this['uniformsLoc'][cI],cR[cI][0x0],cR[cI][0x1],cR[cI][0x2],cR[cI][0x3]);break;}cD['viewport'](0x0,0x0,cv,cG),cD['scissor'](0x0,0x0,cv,cG);}['save'](cD){return{'program':cD['getParameter'](cD['CURRENT_PROGRAM']),'arrayBuffer':cD['getParameter'](cD['ARRAY_BUFFER_BINDING']),'framebuffer':cD['getParameter'](cD['FRAMEBUFFER_BINDING']),'vertexArray':cD['getParameter'](cD['VERTEX_ARRAY_BINDING']),'viewport':cD['getParameter'](cD['VIEWPORT']),'scissor':cD['getParameter'](cD['SCISSOR_BOX']),'cullFace':cD['getParameter'](cD['CULL_FACE']),'activeTexture':cD['getParameter'](cD['ACTIVE_TEXTURE']),'textures':this['inputs']['map']((cx,cR)=>(cD['activeTexture'](cD['TEXTURE0']+cR),cD['getParameter'](cD['TEXTURE_BINDING_2D'])))};}['restore'](cD,cx){cD['useProgram'](cx['program']),cD['bindBuffer'](cD['ARRAY_BUFFER'],cx['arrayBuffer']),cD['bindFramebuffer'](cD['FRAMEBUFFER'],cx['framebuffer']),cD['bindVertexArray'](cx['vertexArray']),cD['viewport'](cx['viewport'][0x0],cx['viewport'][0x1],cx['viewport'][0x2],cx['viewport'][0x3]),cD['scissor'](cx['scissor'][0x0],cx['scissor'][0x1],cx['scissor'][0x2],cx['scissor'][0x3]);for(let cR=0x0;cR<cx['textures']['length'];cR++)cD['activeTexture'](cD['TEXTURE0']+cR),cD['bindTexture'](cD['TEXTURE_2D'],cx['textures'][cR]);cD['activeTexture'](cx['activeTexture']),cx['cullFace']?cD['enable'](cD['CULL_FACE']):cD['disable'](cD['CULL_FACE']);}}const cW='\x0a\x20\x20\x20\x20attribute\x20vec2\x20position;\x0a\x20\x20\x20\x20varying\x20vec2\x20coords;\x0a\x20\x20\x20\x20uniform\x20float\x20flip;\x0a\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20coords\x20=\x20(vec2(position.x,\x20-position.y)\x20+\x201.0)\x20*\x200.5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20vec4(position.x,\x20position.y\x20*\x20flip,\x200,\x201.0);\x0a\x20\x20\x20\x20}\x0a',cZ='\x0a\x20\x20\x20\x20precision\x20mediump\x20float;\x0a\x20\x20\x20\x20varying\x20vec2\x20coords;\x0a\x20\x20\x20\x20uniform\x20vec2\x20size;\x0a\x20\x20\x20\x20uniform\x20sampler2D\x20image;\x0a\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20texture2D(image,\x20coords);\x0a\x20\x20\x20\x20}\x0a';class cj extends c4{constructor(cD){super(cD),this['shaderCtx']=null,this['current']=null;const cx=this['canvas']['layers'][0x0];this['shaderCtx']=cx['getContext']('webgl2',{'alpha':!0x0,'preserveDrawingBuffer':!0x0});}async['load'](){const {shaderCtx:cD,videoSize:cx}=this;if(cD)return this['shader']=new cq(cD,cx),this['input']=new c6(cD,cx),super['load']();}['unload'](){var cD,cx;(cD=this['input'])==null||cD['dispose'](),delete this['input'],(cx=this['shader'])==null||cx['dispose'](),delete this['shader'],super['unload']();}async['update'](cD,cx){if(!this['loaded'])return;const {input:cR}=this,cv=cR==null?void 0x0:cR['texture']();if(!(!cR||!cv))return cR==null||cR['update'](cx),this['current']=cv,super['update'](cD,cx);}['updateVideo'](cD){!this['shader']||(this['shader']['render']([this['current']]),super['updateVideo'](cD));}['setupVideo'](cD,cx){var cR,cv;super['setupVideo'](cD,cx);const {width:cG,height:cn}=this['videoSize'];this['canvas']['layers'][0x0]['width']=cG,this['canvas']['layers'][0x0]['height']=cn,(cR=this['input'])==null||cR['resize']({'width':cG,'height':cn}),(cv=this['shader'])==null||cv['resize']({'width':cG,'height':cn});}}class cH extends cj{['dispose'](){delete this['scene'],super['dispose']();}}class cX{constructor(){this['loaded']=!0x1;}async['load'](cD){this['loaded']||(this['renderer']=cD,this['loaded']=!0x0);}['unload'](){!this['loaded']||(this['loaded']=!0x1);}async['update'](cD,cx){this['loaded'];}['dispose'](){this['unload']();}['setupVideo'](cD){}}class cL extends cX{async['load'](cD){if(!(this['loaded']||!(cD instanceof c5)||!cD['videoCtx']))return this['videoCtx']=cD['videoCtx'],super['load'](cD);}['unload'](){!this['loaded']||(delete this['videoCtx'],super['unload']());}}var ci=Object['defineProperty'],cz=Object['getOwnPropertySymbols'],cr=Object['prototype']['hasOwnProperty'],cK=Object['prototype']['propertyIsEnumerable'],cB=(cD,cx,cR)=>cx in cD?ci(cD,cx,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':cR}):cD[cx]=cR,cu=(cD,cx)=>{for(var cR in cx||(cx={}))cr['call'](cx,cR)&&cB(cD,cR,cx[cR]);if(cz){for(var cR of cz(cx))cK['call'](cx,cR)&&cB(cD,cR,cx[cR]);}return cD;};class cl extends cX{constructor(cD,cx,cR,cv){super(),this['inputs']=cD,this['uniforms']=cx,this['fragSrc']=cR,this['vertSrc']=cv,this['size']={'width':0x0,'height':0x0};}async['load'](cD){if(!(this['loaded']||!(cD instanceof cj)||!cD['shaderCtx']))return this['shader']=new cq(cD['shaderCtx'],this['size'],this['inputs'],this['uniforms'],this['fragSrc'],this['vertSrc']),super['load'](cD);}['unload'](){var cD;!this['loaded']||((cD=this['shader'])==null||cD['dispose'](),delete this['shader'],super['unload']());}async['update'](cD,cx){var cR,cv;const {renderer:cG}=this;if(!this['loaded']||!(cG instanceof cj)||!cG['current'])return;const cn=this['process'](cD,cG['current'])&&((cv=(cR=this['shader'])==null?void 0x0:cR['output'])==null?void 0x0:cv['texture']());cn&&(cG['current']=cn);}['process'](cD,cx){var cR;return(cR=this['shader'])==null||cR['process']([cx]),!0x0;}['setupVideo'](cD){var cx;this['size']=cu({},cD),(cx=this['shader'])==null||cx['resize'](cD);}}class ct extends cX{async['load'](cD){if(!(this['loaded']||!(cD instanceof cH)||!cD['scene']))return this['scene']=cD['scene'],super['load'](cD);}['unload'](){!this['loaded']||(delete this['scene'],super['unload']());}}class co{constructor(cD,cx=!0x1,cR='video',cv){this['renderer']=cD,this['mirror']=cx,this['sizeMode']=cR,this['sizeMax']=cv;}async['snapshot'](){return new Promise(cD=>{this['renderer']['once']('render',()=>{const {renderer:cx}=this,{layers:cR}=cx['canvas'];let {width:cv,height:cG}=cx['canvas']['layers'][0x0];this['sizeMode']==='max'?(cv=Math['max'](...cR['map'](cf=>cf['width'])),cG=Math['max'](...cR['map'](cf=>cf['height']))):this['sizeMode']==='min'&&(cv=Math['min'](...cR['map'](cf=>cf['width'])),cG=Math['min'](...cR['map'](cf=>cf['height'])));const cn=document['createElement']('canvas');cn['id']='engeenee.snapshot',cn['hidden']=!0x0,cn['width']=cv,cn['height']=cG;const cI=cn['getContext']('2d',{'alpha':!0x0});if(!cI)return;this['mirror']&&(cI['translate'](cv,0x0),cI['scale'](-0x1,0x1)),cR['forEach'](cf=>cI['drawImage'](cf,0x0,0x0,cv,cG));const cT=cI['getImageData'](0x0,0x0,cv,cG);cn['remove'](),cD(cT);});});}async['snapshotLayers'](){return new Promise(cD=>{this['renderer']['once']('render',()=>{const cx=document['createElement']('canvas');cx['id']='engeenee.snapshot',cx['hidden']=!0x0;const cR=cx['getContext']('2d',{'alpha':!0x0});if(!cR)return;const cv=this['renderer']['canvas']['layers']['map'](cG=>{const {width:cn,height:cI}=cG;return cx['width']=cn,cx['height']=cI,cR['resetTransform'](),this['mirror']&&(cR['translate'](cn,0x0),cR['scale'](-0x1,0x1)),cR['drawImage'](cG,0x0,0x0),cR['getImageData'](0x0,0x0,cn,cI);});cx['remove'](),cD(cv);});});}}class cU{constructor(cD,cx='video/webm',cR=!0x1,cv='video',cG,cn){this['renderer']=cD,this['type']=cx,this['mirror']=cR,this['sizeMode']=cv,this['sizeMax']=cG,this['bitRate']=cn,this['context']=null,this['records']=[],this['frame']=()=>{var cI;const {renderer:cT,context:cf,stream:cy}=this,{width:cJ,height:cd}=this['canvas'];!cy||!cf||(cT['canvas']['layers']['map'](cM=>cf['drawImage'](cM,0x0,0x0,cJ,cd)),(cI=cy['getVideoTracks']()[0x0])==null||cI['requestFrame']());},this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}['start'](){const {canvas:cD,context:cx,renderer:cR}=this;if(!cD||!cx)return!0x1;const {layers:cv}=cR['canvas'];let {width:cG,height:cn}=cv[0x0];this['sizeMode']==='max'?(cG=Math['max'](...cv['map'](cT=>cT['width'])),cn=Math['max'](...cv['map'](cT=>cT['height']))):this['sizeMode']==='min'&&(cG=Math['min'](...cv['map'](cT=>cT['width'])),cn=Math['min'](...cv['map'](cT=>cT['height'])));const cI=Math['max'](cG,cn);if(this['sizeMax']&&cI>this['sizeMax']){const cT=this['sizeMax']/cI;cG*=cT,cn*=cT;}return cD['width']=cG,cD['height']=cn,cx['resetTransform'](),this['mirror']&&(cx['translate'](cG,0x0),cx['scale'](-0x1,0x1)),cR['on']('render',this['frame']),this['records']=[],this['stream']=cD['captureStream'](0x0),this['recorder']=new MediaRecorder(this['stream'],{'mimeType':this['type'],'videoBitsPerSecond':this['bitRate']}),this['recorder']['ondataavailable']=cf=>this['records']['push'](cf['data']),this['recorder']['start'](),!0x0;}async['stop'](){const {recorder:cD}=this;if(!(!cD||cD['state']!='recording'))return new Promise(cx=>{cD['onstop']=()=>{var cR;cx(new Blob(this['records'],{'type':this['type']})),this['records']=[],(cR=this['stream'])==null||cR['getVideoTracks']()['forEach'](cv=>cv['stop']()),this['renderer']['removeListener']('render',this['frame']),delete this['stream'],delete this['recorder'];},cD['stop']();});}['dispose'](){this['canvas']['remove']();}}class ca{constructor(cD,cx=!0x1,cR='video',cv){this['renderer']=cD,this['mirror']=cx,this['sizeMode']=cR,this['sizeMax']=cv,this['context']=null,this['render']=()=>{const {canvas:cG,context:cn}=this;!cG||!cn||this['renderer']['canvas']['layers']['map'](cI=>cn['drawImage'](cI,0x0,0x0,cG['width'],cG['height']));},this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['mirror']&&(this['canvas']['style']['transform']='scaleX(-1)'),this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}['start'](){const {canvas:cD,context:cx,renderer:cR}=this;if(!cD||!cx)return!0x1;const {layers:cv}=cR['canvas'];let {width:cG,height:cn}=cv[0x0];this['sizeMode']==='max'?(cG=Math['max'](...cv['map'](cT=>cT['width'])),cn=Math['max'](...cv['map'](cT=>cT['height']))):this['sizeMode']==='min'&&(cG=Math['min'](...cv['map'](cT=>cT['width'])),cn=Math['min'](...cv['map'](cT=>cT['height'])));const cI=Math['max'](cG,cn);if(this['sizeMax']&&cI>this['sizeMax']){const cT=this['sizeMax']/cI;cG*=cT,cn*=cT;}return cD['width']=cG,cD['height']=cn,cx['resetTransform'](),this['mirror']&&(cx['translate'](cG,0x0),cx['scale'](-0x1,0x1)),this['renderer']['on']('render',this['render']),this['stream']=cD['captureStream'](),!0x0;}['pause'](){this['renderer']['removeListener']('render',this['render']);}['mediaStream'](){return this['stream'];}}export{v as AsyncEngine,c4 as CanvasRenderer,x as Engine,p as EventEmitterT,t as ImageBuffer,c6 as ImageTexture,cX as Plugin,c3 as PluginRenderer,e as Processor,cU as Recorder,c2 as Renderer,h as ResponsiveCanvas,ct as ScenePlugin,cH as SceneRenderer,cl as ShaderPlugin,cq as ShaderProgram,cj as ShaderRenderer,co as Snapshoter,ca as Streamer,a as VideoCapture,cL as VideoPlugin,c5 as VideoRenderer,o as VideoSource};
