import{EventEmitter as j}from'events';class t extends j{}var h=Object['defineProperty'],d=Object['getOwnPropertySymbols'],s=Object['prototype']['hasOwnProperty'],D=Object['prototype']['propertyIsEnumerable'],G=(Qk,Qz,QA)=>Qz in Qk?h(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,T=(Qk,Qz)=>{for(var QA in Qz||(Qz={}))s['call'](Qz,QA)&&G(Qk,QA,Qz[QA]);if(d){for(var QA of d(Qz))D['call'](Qz,QA)&&G(Qk,QA,Qz[QA]);}return Qk;},o=(Qk,Qz,QA)=>(G(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class u{constructor(Qk='canvas'){o(this,'size',{'width':0x0,'height':0x0}),o(this,'canvas'),o(this,'context',null),this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.capture.'+Qk,this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}['capture'](Qk){const {context:Qz}=this;if(!Qz)return!0x1;const {width:QA,height:QG}=this['size'];return Qz['drawImage'](Qk,0x0,0x0,QA,QG),!0x0;}['data'](){const {context:Qk}=this;if(!Qk)return;const {width:Qz,height:QA}=this['size'];return Qk['getImageData'](0x0,0x0,Qz,QA);}['setSize'](Qk){this['size']=T({},Qk),this['canvas']['width']=Qk['width'],this['canvas']['height']=Qk['height'];}['fill'](){const {context:Qk}=this;Qk&&(Qk['fillStyle']='rgba(255,\x20255,\x20255,\x201)',Qk['fillRect'](0x0,0x0,this['size']['width'],this['size']['height']));}['dispose'](){this['context']=null,this['canvas']['remove']();}}class N extends t{constructor(){super(),o(this,'buffer',new u('capture')),o(this,'captureTime',0x0),o(this,'timer');}async['setup'](Qk){const Qz=Qk&&(QA=>typeof QA!='string'&&'size'in QA)(Qk)&&Qk['size']||{'width':0x780,'height':0x438};return this['updateSize'](Qz),this['buffer']['fill'](),!0x0;}['dispose'](){this['reset'](),this['buffer']['dispose']();}async['start'](){this['captureTime']=0x0,this['timer']=Date['now']();}['pause'](){}['reset'](){this['pause'](),delete this['timer'];}['capture'](){return this['timer']===void 0x0?!0x1:(this['captureTime']=(Date['now']()-this['timer'])*0x3e8,!0x0);}['size'](){return T({},this['buffer']['size']);}['ratio'](){const Qk=this['buffer']['size'];return Qk['width']/Qk['height'];}['updateSize'](Qk){this['buffer']['setSize'](Qk),this['emit']('resize',this['buffer']['size']);}}var i=Object['defineProperty'],P=(Qk,Qz,QA)=>Qz in Qk?i(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,a=(Qk,Qz,QA)=>(P(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class w extends N{constructor(){super(),a(this,'videoRef'),a(this,'timeShift',0x0),this['videoRef']=document['createElement']('video'),this['videoRef']['id']='engeenee.capture.source',this['videoRef']['muted']=!0x0,this['videoRef']['loop']=!0x0,this['videoRef']['playsInline']=!0x0;}async['setup'](Qk){const Qz=Ql=>typeof Ql=='string'||'getVideoTracks'in Ql,QA=Ql=>'video'in Ql,QG=Ql=>{if(!Ql)return{'video':!0x0,'audio':!0x1};if(QA(Ql))return Ql;const QC=Ql['size'];return{'video':{'facingMode':Ql['rear']?'environment':'user','width':QC==null?void 0x0:QC['width'],'height':QC==null?void 0x0:QC['height'],'frameRate':Ql['fps']},'audio':!0x1};},Qc=Qk!==void 0x0&&Qz(Qk)?Qk:await navigator['mediaDevices']['getUserMedia'](QG(Qk))['catch'](()=>{});if(!Qc)return!0x1;const {videoRef:QU}=this;return new Promise(Ql=>{QU['onloadedmetadata']=()=>{this['updateSize']({'width':QU['videoWidth'],'height':QU['videoHeight']}),QU['onresize']=()=>{this['updateSize']({'width':QU['videoWidth'],'height':QU['videoHeight']});},QU['onseeked']=()=>{this['timeShift']=this['captureTime'],this['captureTime']=0x0;},Ql(!0x0);},typeof Qc=='string'?QU['src']=Qc:QU['srcObject']=Qc;});}['dispose'](){super['dispose'](),this['videoRef']['remove']();}async['start'](){this['captureTime']=0x0,this['timeShift']=0x0,(this['videoRef']['srcObject']||this['videoRef']['src'])&&await this['videoRef']['play']();}['pause'](){this['videoRef']['pause']();}['reset'](){this['pause'](),this['videoRef']['srcObject']&&(this['videoRef']['srcObject']['getTracks']()['forEach'](Qk=>Qk['stop']()),this['videoRef']['srcObject']=null);}['capture'](){const {videoRef:Qk,buffer:Qz}=this,QA=Qk['currentTime']+this['timeShift'];return QA<=this['captureTime']?!0x1:(this['captureTime']=QA,Qz['capture'](Qk));}}var e=Object['defineProperty'],r=(Qk,Qz,QA)=>Qz in Qk?e(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,S=(Qk,Qz,QA)=>(r(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class b extends t{constructor(Qk,Qz,QA=w){super(),this['engineParams']=Qz,S(this,'processor'),S(this,'renderers',[]),S(this,'video'),S(this,'videoRatio',0x780/0x438),S(this,'streamCanvas'),S(this,'streamSize',{'width':0x780,'height':0x438}),S(this,'processCanvas'),S(this,'processSize',{'width':0x780,'height':0x438}),S(this,'resizeBuffer'),S(this,'resizeEnabled',!0x1),S(this,'loopState',!0x1),S(this,'loopId'),S(this,'init',async QG=>{const Qc=await this['setupProcessor'](QG);return this['emit']('init',Qc),Qc;}),S(this,'setup',async QG=>{this['pause']();const Qc=await this['setupVideo'](QG);return this['emit']('setup',Qc),Qc;}),S(this,'start',async()=>{await this['video']['start'](),this['loopState']=!0x0,this['emit']('start'),this['enqueue']();}),S(this,'pause',()=>{this['loopState']=!0x1,this['loopId']&&(window['cancelAnimationFrame'](this['loopId']),delete this['loopId']),this['video']['pause'](),this['emit']('pause');}),S(this,'reset',()=>{this['pause'](),this['video']['reset'](),delete this['streamCanvas'],delete this['processCanvas'],this['processor']['reset']();}),S(this,'iterate',async()=>{var QG;const {video:Qc,streamCanvas:QU,processCanvas:Ql}=this;if(!Qc['capture']()||!QU||!Ql)return this['enqueue']();this['resizeEnabled']&&((QG=this['resizeBuffer'])==null||QG['capture'](Qc['buffer']['canvas']));const QC=await this['processor']['process'](Ql,Qc['captureTime']);QC&&await Promise['all'](this['renderers']['map'](QT=>QT['update'](QC,QU))),this['enqueue']();}),this['processor']=typeof Qk=='function'?new Qk():Qk,this['video']=typeof QA=='function'?new QA():QA,this['video']['on']('resize',this['resizeVideo']['bind'](this));}async['addRenderer'](Qk){this['renderers']['push'](Qk),await Qk['load'](),Qk['setupVideo'](this['video']['size'](),this['video']['ratio']()),Qk['setupCamera'](this['processor']['cameraRatio'],this['processor']['cameraAngle']);}['removeRenderer'](Qk){const {renderers:Qz}=this,QA=Qz['indexOf'](Qk);QA<0x0||(Qz[QA]['dispose'](),Qz['slice'](QA,0x1));}['enqueue'](){this['loopId']=this['loopState']?window['requestAnimationFrame'](this['iterate']):void 0x0;}async['setupProcessor'](Qk){var Qz;const QA=this['resizeEnabled']&&((Qz=this['resizeBuffer'])==null?void 0x0:Qz['size'])||this['video']['size']();return this['processor']['init'](Qk,QA,this['video']['ratio']());}async['setupVideo'](Qk){return this['video']['reset'](),await this['video']['setup'](Qk)?(this['setupSize'](this['video']['size']()),!0x0):!0x1;}async['setupSize'](Qk){var Qz,QA;const {width:QG,height:Qc}=Qk;this['videoRatio']=QG/Qc;const QU=Math['max'](QG,Qc),Ql=((Qz=this['engineParams'])==null?void 0x0:Qz['max'])||this['processor']['optimalSize'];if(this['resizeEnabled']=!0x1,Ql<QU){this['resizeEnabled']=!0x0;const QC=QU/Ql;this['resizeBuffer']||(this['resizeBuffer']=new u('resize')),this['resizeBuffer']['setSize']({'width':QG/QC,'height':Qc/QC});}this['resizeEnabled']&&this['resizeBuffer']?(this['processCanvas']=this['resizeBuffer']['canvas'],this['processSize']=this['resizeBuffer']['size']):(this['processCanvas']=this['video']['buffer']['canvas'],this['processSize']=this['video']['size']()),((QA=this['engineParams'])==null?void 0x0:QA['orig'])!==!0x1?(this['streamCanvas']=this['video']['buffer']['canvas'],this['streamSize']=this['video']['size']()):(this['streamCanvas']=this['processCanvas'],this['streamSize']=this['streamSize']);}['resizeVideo'](Qk){this['setupSize'](Qk),this['processor']['setupVideo'](this['processSize'],this['videoRatio']),this['renderers']['forEach'](Qz=>Qz['setupVideo'](this['streamSize'],this['videoRatio'])),this['renderers']['forEach'](Qz=>Qz['setupCamera'](this['processor']['cameraRatio'],this['processor']['cameraAngle']));}}var V=Object['defineProperty'],X=Object['getOwnPropertySymbols'],n=Object['prototype']['hasOwnProperty'],j0=Object['prototype']['propertyIsEnumerable'],j1=(Qk,Qz,QA)=>Qz in Qk?V(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,j2=(Qk,Qz)=>{for(var QA in Qz||(Qz={}))n['call'](Qz,QA)&&j1(Qk,QA,Qz[QA]);if(X){for(var QA of X(Qz))j0['call'](Qz,QA)&&j1(Qk,QA,Qz[QA]);}return Qk;},j3=(Qk,Qz,QA)=>(j1(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class j4 extends t{constructor(){super(),j3(this,'params',{}),j3(this,'videoSize',{'width':0x780,'height':0x438}),j3(this,'videoRatio',this['videoSize']['width']/this['videoSize']['height']),j3(this,'optimalSize',0x400),j3(this,'cameraRatio',this['videoRatio']),j3(this,'cameraAngle',0x3c/0xb4*Math['PI']);}async['process'](Qk,Qz){return{};}async['init'](Qk,Qz,QA){return this['params']=Qk,!QA&&Qz&&(QA=Qz['width']/Qz['height']),this['setupVideo'](Qz||this['videoSize'],QA||this['videoRatio']),this['emit']('init',!0x0),!0x0;}['reset'](){this['emit']('reset');}['dispose'](){}['setupVideo'](Qk,Qz){Qz=Qz||Qk['width']/Qk['height'],this['videoSize']=j2({},Qk),this['videoRatio']=Qz,this['cameraRatio']=Qz;}}var j5=Object['defineProperty'],j6=(Qk,Qz,QA)=>Qz in Qk?j5(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,j7=(Qk,Qz,QA)=>(j6(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class j8 extends t{constructor(Qk,Qz='crop',QA=0x1,QG=!0x1,Qc=0x1){super(),this['container']=Qk,this['mode']=Qz,this['layerCount']=QA,this['mirror']=QG,this['aspectRatio']=Qc,j7(this,'layers',[]),j7(this,'pads'),j7(this,'padsSize',[0x1,0x1]),j7(this,'observer'),j7(this,'setAspectRatio',QU=>{this['aspectRatio']=QU,this['updateSizes'](this['container']['clientWidth']/this['container']['clientHeight']);}),j7(this,'setMirror',QU=>{this['mirror']=QU,this['layers']['forEach'](Ql=>{Ql['style']['transform']=QU?'scaleX(-1)':'';});}),j7(this,'updateSizes',QU=>{let Ql=0x1,QC=0x1;QU>this['aspectRatio']?this['mode']==='crop'?QC=QU/this['aspectRatio']:Ql=this['aspectRatio']/QU:this['mode']==='crop'?Ql=this['aspectRatio']/QU:QC=QU/this['aspectRatio'];const QT=(0x1-Ql)/0x2,Qp=(0x1-QC)/0x2,Qo=Ql*0x64+'%',Qu=QC*0x64+'%',QN=QT*0x64+'%',Qy=Qp*0x64+'%';for(const Qv of this['layers'])Qv['style']['width']=Qo,Qv['style']['height']=Qu,Qv['style']['left']=QN,Qv['style']['top']=Qy;if(this['pads']){this['padsSize']=QT>0x0?[QT,0x1]:[0x1,Qp];const QJ=0xa,{clientWidth:Qi,clientHeight:QP}=this['container'],QK=[0x2*QJ/Qi,0x2*QJ/QP],Qa=(this['padsSize'][0x0]+0x2*QK[0x0])*0x64+'%',Qw=(this['padsSize'][0x1]+0x2*QK[0x1])*0x64+'%';this['pads'][0x0]['style']['width']=Qa,this['pads'][0x0]['style']['height']=Qw,this['pads'][0x1]['style']['width']=Qa,this['pads'][0x1]['style']['height']=Qw;const QR=-QK[0x0]*0x64+'%',QL=-QK[0x1]*0x64+'%';this['pads'][0x0]['style']['top']=QL,this['pads'][0x1]['style']['bottom']=QL,this['pads'][0x0]['style']['left']='unset',this['pads'][0x0]['style']['right']='unset',this['pads'][0x1]['style']['left']='unset',this['pads'][0x1]['style']['right']='unset',this['pads'][this['mirror']?0x1:0x0]['style']['left']=QR,this['pads'][this['mirror']?0x0:0x1]['style']['right']=QR;const Qg=QT>0x0?this['mirror']?'':'scaleX(-1)':'scaleY(-1)\x20'+(this['mirror']?'scaleX(-1)':'');this['pads'][0x0]['style']['transform']=Qg,this['pads'][0x1]['style']['transform']=Qg;const Qr='blur('+QJ+'px)';this['pads'][0x0]['style']['filter']=Qr,this['pads'][0x1]['style']['filter']=Qr;}this['emit']('resize');}),j7(this,'handleResize',QU=>{if(QU['length']<0x1)return;const Ql=QU[0x0]['contentRect'];this['updateSizes'](Ql['width']/Ql['height']);});for(let QU=0x0;QU<QA;QU++){const Ql=document['createElement']('canvas');Ql['id']='engeenee.canvas.layer'+QU,Ql['style']['position']='absolute',Ql['style']['zIndex']=-0xa*(QA-QU)+'',this['mirror']&&(Ql['style']['transform']='scaleX(-1)'),this['container']['appendChild'](Ql),this['layers']['push'](Ql);}if(this['mode']==='pad'){this['pads']=[document['createElement']('canvas'),document['createElement']('canvas')];const QC=-0xa*(this['layerCount']+0x1)+'';for(let QT=0x0;QT<0x2;QT++)this['pads'][QT]['id']='engeenee.canvas.pad'+QT,this['pads'][QT]['style']['position']='absolute',this['pads'][QT]['style']['zIndex']=QC,this['container']['appendChild'](this['pads'][QT]);}this['setAspectRatio'](Qc),this['observer']=new ResizeObserver(this['handleResize']),this['observer']['observe'](this['container']),this['container']['style']['overflow']='hidden';}}var j9=Object['defineProperty'],jj=Object['getOwnPropertySymbols'],jQ=Object['prototype']['hasOwnProperty'],jt=Object['prototype']['propertyIsEnumerable'],jm=(Qk,Qz,QA)=>Qz in Qk?j9(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jW=(Qk,Qz)=>{for(var QA in Qz||(Qz={}))jQ['call'](Qz,QA)&&jm(Qk,QA,Qz[QA]);if(jj){for(var QA of jj(Qz))jt['call'](Qz,QA)&&jm(Qk,QA,Qz[QA]);}return Qk;},jx=(Qk,Qz,QA)=>(jm(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jh extends t{constructor(){super(),jx(this,'loaded',!0x1),jx(this,'videoSize',{'width':0x780,'height':0x438}),jx(this,'videoRatio',this['videoSize']['width']/this['videoSize']['height']),jx(this,'cameraRatio',this['videoRatio']),jx(this,'cameraAngle',0x3c/0xb4*Math['PI']);}async['load'](){this['loaded']||(this['loaded']=!0x0,this['emit']('load'));}['unload'](){this['loaded']&&(this['loaded']=!0x1);}async['update'](Qk,Qz){this['loaded']&&(this['updateVideo'](Qz),this['updateScene'](),this['emit']('render'));}['updateVideo'](Qk){}['updateScene'](){}['dispose'](){this['unload']();}['setupVideo'](Qk,Qz){this['videoSize']=jW({},Qk),this['videoRatio']=Qz||Qk['width']/Qk['height'],this['emit']('resize',this['videoSize'],this['videoRatio']);}['setupCamera'](Qk,Qz){this['cameraRatio']=Qk,this['cameraAngle']=Qz;}}var jd=Object['defineProperty'],js=(Qk,Qz,QA)=>Qz in Qk?jd(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jD=(Qk,Qz,QA)=>(js(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jM extends jh{constructor(){super(...arguments),jD(this,'plugins',[]);}async['load'](){if(!this['loaded'])return await Promise['all'](this['plugins']['map'](Qk=>Qk['load'](this))),super['load']();}['unload'](){this['plugins']['forEach'](Qk=>Qk['unload']()),super['unload']();}async['update'](Qk,Qz){if(this['loaded'])return await this['updatePlugins'](Qk,Qz),super['update'](Qk,Qz);}async['updatePlugins'](Qk,Qz){for(let QA of this['plugins'])QA['loaded']&&await QA['update'](Qk,Qz);}['dispose'](){this['plugins']['forEach'](Qk=>Qk['dispose']()),this['plugins']=[],super['dispose']();}async['addPlugin'](Qk){this['loaded']&&!Qk['loaded']&&await Qk['load'](this),this['plugins']['push'](Qk);}['removePlugin'](Qk){const {plugins:Qz}=this,QA=Qz['indexOf'](Qk);QA<0x0||(Qz[QA]['dispose'](),Qz['splice'](QA,0x1));}['removeAllPlugins'](){this['plugins']['forEach'](Qk=>Qk['dispose']()),this['plugins']=[];}['setupVideo'](Qk,Qz){super['setupVideo'](Qk,Qz),this['plugins']['forEach'](QA=>QA['setupVideo'](Qk));}['setupCamera'](Qk,Qz){super['setupCamera'](Qk,Qz),this['plugins']['forEach'](QA=>QA['setupCamera'](Qk,Qz));}}var jI=Object['defineProperty'],jO=(Qk,Qz,QA)=>Qz in Qk?jI(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jk=(Qk,Qz,QA)=>(jO(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jz extends jM{constructor(Qk){super(),jk(this,'canvas'),jk(this,'padCtx',[null,null]),jk(this,'setupPadding',()=>{if(!this['canvas']['pads'])return;const {width:Qz,height:QA}=this['videoSize'],{padsSize:QG}=this['canvas'],Qc=Qz*QG[0x0]/(QG[0x0]<0.5?0x1-0x2*QG[0x0]:0x1),QU=QA*QG[0x1]/(QG[0x1]<0.5?0x1-0x2*QG[0x1]:0x1);this['canvas']['pads'][0x0]['width']=Qc,this['canvas']['pads'][0x0]['height']=QU,this['canvas']['pads'][0x1]['width']=Qc,this['canvas']['pads'][0x1]['height']=QU;}),this['canvas']=new j8(Qk['container'],Qk['mode'],Qk['layerCount'],Qk['mirror'],Qk['aspectRatio']),this['canvas']['pads']&&(this['padCtx']=[this['canvas']['pads'][0x0]['getContext']('2d'),this['canvas']['pads'][0x1]['getContext']('2d')],this['canvas']['addListener']('resize',this['setupPadding']));}['updateVideo'](Qk){super['updateVideo'](Qk),this['updatePads'](Qk);}['setupVideo'](Qk,Qz){super['setupVideo'](Qk,Qz),this['canvas']['setAspectRatio'](this['videoRatio']);}['setMirror'](Qk){this['canvas']['setMirror'](Qk);}['updatePads'](Qk){if(!this['padCtx'][0x0]||!this['padCtx'][0x1]||!this['canvas']['pads'])return;const {videoSize:{width:Qz,height:QA}}=this,{width:QG,height:Qc}=this['canvas']['pads'][0x0];this['padCtx'][0x0]['clearRect'](0x0,0x0,QG,Qc),this['padCtx'][0x0]['drawImage'](Qk,0x0,0x0,QG,Qc,0x0,0x0,QG,Qc),this['padCtx'][0x1]['clearRect'](0x0,0x0,QG,Qc),this['padCtx'][0x1]['drawImage'](Qk,Qz-QG,QA-Qc,QG,Qc,0x0,0x0,QG,Qc);}}var jA=Object['defineProperty'],jG=(Qk,Qz,QA)=>Qz in Qk?jA(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jc=(Qk,Qz,QA)=>(jG(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jU extends jz{constructor(Qk){super(Qk),jc(this,'videoCtx',null);const Qz=this['canvas']['layers'][0x0];this['videoCtx']=Qz['getContext']('2d');}['updateVideo'](Qk){const {videoCtx:Qz}=this;if(!Qz)return;const {width:QA,height:QG}=this['videoSize'];Qz['clearRect'](0x0,0x0,QA,QG),Qz['drawImage'](Qk,0x0,0x0),super['updateVideo'](Qk);}['setupVideo'](Qk,Qz){super['setupVideo'](Qk,Qz);const {width:QA,height:QG}=this['videoSize'];this['canvas']['layers'][0x0]['width']=QA,this['canvas']['layers'][0x0]['height']=QG;}}var jl=Object['defineProperty'],jC=(Qk,Qz,QA)=>Qz in Qk?jl(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jT=(Qk,Qz,QA)=>(jC(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jp{constructor(Qk,Qz={'width':0x780,'height':0x438},QA=!0x1,QG=!0x1){this['gl']=Qk,this['size']=Qz,this['grayscale']=QA,this['linear']=QG,jT(this,'buffer',null),this['resize'](Qz);}['update'](Qk){const {gl:Qz,size:{width:QA,height:QG}}=this,Qc=Qz['getParameter'](Qz['TEXTURE_BINDING_2D']),QU=Qz['getParameter'](Qz['UNPACK_FLIP_Y_WEBGL']);Qz['bindTexture'](Qz['TEXTURE_2D'],this['buffer']),Qz['pixelStorei'](Qz['UNPACK_FLIP_Y_WEBGL'],!0x1),Qk instanceof Uint8Array?Qz['texSubImage2D'](Qz['TEXTURE_2D'],0x0,0x0,0x0,QA,QG,this['grayscale']?Qz['RED']:Qz['RGBA'],Qz['UNSIGNED_BYTE'],Qk):Qz['texSubImage2D'](Qz['TEXTURE_2D'],0x0,0x0,0x0,QA,QG,this['grayscale']?Qz['RED']:Qz['RGBA'],Qz['UNSIGNED_BYTE'],Qk),Qz['bindTexture'](Qz['TEXTURE_2D'],Qc),Qz['pixelStorei'](Qz['UNPACK_FLIP_Y_WEBGL'],QU);}['resize'](Qk){if(Qk['width']===this['size']['width']&&Qk['height']===this['size']['height']&&this['buffer'])return!0x0;const {gl:Qz}=this;if(Qz['deleteTexture'](this['buffer']),this['buffer']=null,(Qk['width']>0x0||Qk['height']>0x0)&&(this['buffer']=Qz['createTexture']()),!this['buffer'])return!0x1;const QA=this['linear']?Qz['LINEAR']:Qz['NEAREST'],QG=Qz['getParameter'](Qz['TEXTURE_BINDING_2D']),Qc=Qz['getParameter'](Qz['UNPACK_FLIP_Y_WEBGL']);return Qz['bindTexture'](Qz['TEXTURE_2D'],this['buffer']),Qz['pixelStorei'](Qz['UNPACK_FLIP_Y_WEBGL'],!0x1),Qz['texParameteri'](Qz['TEXTURE_2D'],Qz['TEXTURE_WRAP_S'],Qz['CLAMP_TO_EDGE']),Qz['texParameteri'](Qz['TEXTURE_2D'],Qz['TEXTURE_WRAP_T'],Qz['CLAMP_TO_EDGE']),Qz['texParameteri'](Qz['TEXTURE_2D'],Qz['TEXTURE_MIN_FILTER'],QA),Qz['texParameteri'](Qz['TEXTURE_2D'],Qz['TEXTURE_MAG_FILTER'],QA),this['size']={'width':Qk['width'],'height':Qk['height']},Qz['texStorage2D'](Qz['TEXTURE_2D'],0x1,this['grayscale']?Qz['R8']:Qz['RGBA8'],Qk['width'],Qk['height']),Qz['bindTexture'](Qz['TEXTURE_2D'],QG),Qz['pixelStorei'](Qz['UNPACK_FLIP_Y_WEBGL'],Qc),!0x0;}['dispose'](){this['gl']['deleteTexture'](this['buffer']),this['buffer']=null;}['texture'](){return this['buffer'];}['valid'](){return!!this['buffer'];}}var jo=Object['defineProperty'],ju=Object['getOwnPropertySymbols'],jN=Object['prototype']['hasOwnProperty'],jy=Object['prototype']['propertyIsEnumerable'],jv=(Qk,Qz,QA)=>Qz in Qk?jo(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jJ=(Qk,Qz)=>{for(var QA in Qz||(Qz={}))jN['call'](Qz,QA)&&jv(Qk,QA,Qz[QA]);if(ju){for(var QA of ju(Qz))jy['call'](Qz,QA)&&jv(Qk,QA,Qz[QA]);}return Qk;},ji=(Qk,Qz,QA)=>(jv(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jP{constructor(Qk,Qz={'width':0x780,'height':0x438},QA=['image'],QG={'size':'2f','flip':'1f'},Qc=ja,QU=jK,Ql=!0x1){this['gl']=Qk,this['size']=Qz,this['inputs']=QA,this['uniforms']=QG,ji(this,'vertShader',null),ji(this,'fragShader',null),ji(this,'shaderProgram',null),ji(this,'vertBuffer',null),ji(this,'vertAttrs',null),ji(this,'uniformsLoc',{}),ji(this,'frameBuffer',null),ji(this,'output'),Qc['includes']('uniform\x20vec2\x20size;')&&!QG['size']&&(QG['size']='2f'),QU['includes']('uniform\x20float\x20flip;')&&!QG['flip']&&(QG['flip']='1f'),this['output']=new jp(Qk,Qz,!0x1,Ql),this['compile'](Qc,QU),this['resize'](Qz);}['process'](Qk,Qz={}){const {gl:QA,output:QG}=this;if(!QA||!QG||Qk['length']!==this['inputs']['length'])return;const Qc=this['save'](QA);QA['bindFramebuffer'](QA['FRAMEBUFFER'],this['frameBuffer']),QA['framebufferTexture2D'](QA['FRAMEBUFFER'],QA['COLOR_ATTACHMENT0'],QA['TEXTURE_2D'],QG['texture'](),0x0),Qz=jJ({'flip':[-0x1]},Qz),this['prepare'](QA,Qk,Qz),QA['drawArrays'](QA['TRIANGLES'],0x0,0x6),this['restore'](QA,Qc);}['render'](Qk,Qz={}){const {gl:QA,output:QG}=this;if(!QA||!QG||Qk['length']!==this['inputs']['length'])return;const Qc=this['save'](QA);QA['bindFramebuffer'](QA['FRAMEBUFFER'],null),Qz=jJ({'flip':[0x1]},Qz),this['prepare'](QA,Qk,Qz),QA['drawArrays'](QA['TRIANGLES'],0x0,0x6),this['restore'](QA,Qc);}['resize'](Qk){var Qz;const {gl:QA}=this;this['size']={'width':Qk['width'],'height':Qk['height']},(Qz=this['output'])==null||Qz['resize'](Qk);const QG=QA['getParameter'](QA['CURRENT_PROGRAM']);QA['useProgram'](this['shaderProgram']),this['uniformsLoc']['size']&&QA['uniform2f'](this['uniformsLoc']['size'],Qk['width'],Qk['height']),QA['useProgram'](QG);}['dispose'](){var Qk;const {gl:Qz}=this;Qz['deleteBuffer'](this['vertBuffer']),this['vertBuffer']=null,Qz['deleteFramebuffer'](this['frameBuffer']),this['frameBuffer']=null,Qz['deleteShader'](this['vertShader']),this['vertShader']=null,Qz['deleteShader'](this['fragShader']),this['fragShader']=null,Qz['deleteProgram'](this['shaderProgram']),this['shaderProgram']=null,(Qk=this['output'])==null||Qk['dispose'](),delete this['output'];}['program'](){return this['shaderProgram'];}['compile'](Qk,Qz){const {gl:QA}=this,QG=this['save'](QA);if(this['vertBuffer']=QA['createBuffer'](),this['vertAttrs']=QA['createVertexArray'](),this['frameBuffer']=QA['createFramebuffer'](),!this['vertBuffer']||!this['frameBuffer']||!this['vertAttrs']){QA['deleteBuffer'](this['vertBuffer']),this['vertBuffer']=null,QA['deleteFramebuffer'](this['frameBuffer']),this['frameBuffer']=null,QA['deleteVertexArray'](this['vertAttrs']),this['vertAttrs']=null;return;}if(this['vertShader']=QA['createShader'](QA['VERTEX_SHADER']),this['fragShader']=QA['createShader'](QA['FRAGMENT_SHADER']),this['shaderProgram']=QA['createProgram'](),!this['vertShader']||!this['fragShader']||!this['shaderProgram']){QA['deleteBuffer'](this['vertBuffer']),this['vertBuffer']=null,QA['deleteFramebuffer'](this['frameBuffer']),this['frameBuffer']=null,QA['deleteShader'](this['vertShader']),this['vertShader']=null,QA['deleteShader'](this['fragShader']),this['fragShader']=null,QA['deleteProgram'](this['shaderProgram']),this['shaderProgram']=null;return;}QA['shaderSource'](this['vertShader'],Qz),QA['shaderSource'](this['fragShader'],Qk),QA['compileShader'](this['vertShader']),QA['compileShader'](this['fragShader']),QA['attachShader'](this['shaderProgram'],this['vertShader']),QA['attachShader'](this['shaderProgram'],this['fragShader']),QA['linkProgram'](this['shaderProgram']),QA['useProgram'](this['shaderProgram']),QA['bindBuffer'](QA['ARRAY_BUFFER'],this['vertBuffer']),QA['bufferData'](QA['ARRAY_BUFFER'],new Float32Array([-0x1,-0x1,0x1,0x1,-0x1,0x1,-0x1,-0x1,0x1,-0x1,0x1,0x1]),QA['STATIC_DRAW']),QA['bindVertexArray'](this['vertAttrs']);const Qc=QA['getAttribLocation'](this['shaderProgram'],'position');QA['vertexAttribPointer'](Qc,0x2,QA['FLOAT'],!0x1,0x0,0x0),QA['enableVertexAttribArray'](Qc),this['uniformsLoc']={};for(let QU in this['uniforms'])this['uniformsLoc'][QU]=QA['getUniformLocation'](this['shaderProgram'],QU);for(let Ql=0x0;Ql<this['inputs']['length'];Ql++)QA['uniform1i'](QA['getUniformLocation'](this['shaderProgram'],this['inputs'][Ql]),Ql);this['restore'](QA,QG);}['prepare'](Qk,Qz,QA={}){const {size:{width:QG,height:Qc}}=this;for(let QU=0x0;QU<Qz['length'];QU++)Qk['activeTexture'](Qk['TEXTURE0']+QU),Qk['bindTexture'](Qk['TEXTURE_2D'],Qz[QU]);Qk['useProgram'](this['shaderProgram']),Qk['bindVertexArray'](this['vertAttrs']);for(let Ql in QA)switch(this['uniforms'][Ql]){case'1f':this['uniformsLoc'][Ql]&&QA[Ql]['length']===0x1&&Qk['uniform1f'](this['uniformsLoc'][Ql],QA[Ql][0x0]);break;case'2f':this['uniformsLoc'][Ql]&&QA[Ql]['length']===0x2&&Qk['uniform2f'](this['uniformsLoc'][Ql],QA[Ql][0x0],QA[Ql][0x1]);break;case'3f':this['uniformsLoc'][Ql]&&QA[Ql]['length']===0x3&&Qk['uniform3f'](this['uniformsLoc'][Ql],QA[Ql][0x0],QA[Ql][0x1],QA[Ql][0x2]);break;case'4f':this['uniformsLoc'][Ql]&&QA[Ql]['length']===0x4&&Qk['uniform4f'](this['uniformsLoc'][Ql],QA[Ql][0x0],QA[Ql][0x1],QA[Ql][0x2],QA[Ql][0x3]);break;}Qk['disable'](Qk['CULL_FACE']),Qk['colorMask'](!0x0,!0x0,!0x0,!0x0),Qk['viewport'](0x0,0x0,QG,Qc),Qk['scissor'](0x0,0x0,QG,Qc);}['save'](Qk){return{'program':Qk['getParameter'](Qk['CURRENT_PROGRAM']),'arrayBuffer':Qk['getParameter'](Qk['ARRAY_BUFFER_BINDING']),'framebuffer':Qk['getParameter'](Qk['FRAMEBUFFER_BINDING']),'vertexArray':Qk['getParameter'](Qk['VERTEX_ARRAY_BINDING']),'viewport':Qk['getParameter'](Qk['VIEWPORT']),'scissor':Qk['getParameter'](Qk['SCISSOR_BOX']),'colorMask':Qk['getParameter'](Qk['COLOR_WRITEMASK']),'cullFace':Qk['getParameter'](Qk['CULL_FACE']),'activeTexture':Qk['getParameter'](Qk['ACTIVE_TEXTURE']),'textures':this['inputs']['map']((Qz,QA)=>(Qk['activeTexture'](Qk['TEXTURE0']+QA),Qk['getParameter'](Qk['TEXTURE_BINDING_2D'])))};}['restore'](Qk,Qz){Qk['useProgram'](Qz['program']),Qk['bindBuffer'](Qk['ARRAY_BUFFER'],Qz['arrayBuffer']),Qk['bindFramebuffer'](Qk['FRAMEBUFFER'],Qz['framebuffer']),Qk['bindVertexArray'](Qz['vertexArray']),Qk['viewport'](Qz['viewport'][0x0],Qz['viewport'][0x1],Qz['viewport'][0x2],Qz['viewport'][0x3]),Qk['scissor'](Qz['scissor'][0x0],Qz['scissor'][0x1],Qz['scissor'][0x2],Qz['scissor'][0x3]),Qk['colorMask'](Qz['colorMask'][0x0],Qz['colorMask'][0x1],Qz['colorMask'][0x2],Qz['colorMask'][0x3]);for(let QA=0x0;QA<Qz['textures']['length'];QA++)Qk['activeTexture'](Qk['TEXTURE0']+QA),Qk['bindTexture'](Qk['TEXTURE_2D'],Qz['textures'][QA]);Qk['activeTexture'](Qz['activeTexture']),Qz['cullFace']?Qk['enable'](Qk['CULL_FACE']):Qk['disable'](Qk['CULL_FACE']);}}const jK='\x0a\x20\x20\x20\x20attribute\x20vec2\x20position;\x0a\x20\x20\x20\x20varying\x20vec2\x20coords;\x0a\x20\x20\x20\x20uniform\x20float\x20flip;\x0a\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20coords\x20=\x20(vec2(position.x,\x20-position.y)\x20+\x201.0)\x20*\x200.5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20vec4(position.x,\x20position.y\x20*\x20flip,\x200,\x201.0);\x0a\x20\x20\x20\x20}\x0a',ja='\x0a\x20\x20\x20\x20precision\x20mediump\x20float;\x0a\x20\x20\x20\x20varying\x20vec2\x20coords;\x0a\x20\x20\x20\x20uniform\x20vec2\x20size;\x0a\x20\x20\x20\x20uniform\x20sampler2D\x20image;\x0a\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20texture2D(image,\x20coords);\x0a\x20\x20\x20\x20}\x0a';var jw=Object['defineProperty'],jR=(Qk,Qz,QA)=>Qz in Qk?jw(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jL=(Qk,Qz,QA)=>(jR(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jg extends jz{constructor(Qk){super(Qk),jL(this,'shaderCtx',null),jL(this,'shader'),jL(this,'input'),jL(this,'current',null);const Qz=this['canvas']['layers'][0x0];this['shaderCtx']=Qz['getContext']('webgl2',{'alpha':!0x0,'preserveDrawingBuffer':!0x0});}async['load'](){const {shaderCtx:Qk,videoSize:Qz}=this;if(Qk)return this['shader']=new jP(Qk,Qz),this['input']=new jp(Qk,Qz),super['load']();}['unload'](){var Qk,Qz;(Qk=this['input'])==null||Qk['dispose'](),delete this['input'],(Qz=this['shader'])==null||Qz['dispose'](),delete this['shader'],super['unload']();}async['update'](Qk,Qz){if(!this['loaded'])return;const {input:QA}=this,QG=QA==null?void 0x0:QA['texture']();if(!(!QA||!QG))return QA==null||QA['update'](Qz),this['current']=QG,super['update'](Qk,Qz);}['updateVideo'](Qk){this['shader']&&(this['shader']['render']([this['current']]),super['updateVideo'](Qk));}['setupVideo'](Qk,Qz){var QA,QG;super['setupVideo'](Qk,Qz);const {width:Qc,height:QU}=this['videoSize'];this['canvas']['layers'][0x0]['width']=Qc,this['canvas']['layers'][0x0]['height']=QU,(QA=this['input'])==null||QA['resize']({'width':Qc,'height':QU}),(QG=this['shader'])==null||QG['resize']({'width':Qc,'height':QU});}}var jr=Object['defineProperty'],jS=(Qk,Qz,QA)=>Qz in Qk?jr(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jE=(Qk,Qz,QA)=>(jS(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jF extends jg{constructor(){super(...arguments),jE(this,'scene');}['dispose'](){delete this['scene'],super['dispose']();}}var jY=Object['defineProperty'],jH=(Qk,Qz,QA)=>Qz in Qk?jY(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jf=(Qk,Qz,QA)=>(jH(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jb{constructor(){jf(this,'renderer'),jf(this,'loaded',!0x1);}async['load'](Qk){this['loaded']||(this['renderer']=Qk,this['loaded']=!0x0);}['unload'](){this['loaded']&&(this['loaded']=!0x1);}async['update'](Qk,Qz){this['loaded'];}['dispose'](){this['unload']();}['setupVideo'](Qk){}['setupCamera'](Qk,Qz){}}var jZ=Object['defineProperty'],jB=(Qk,Qz,QA)=>Qz in Qk?jZ(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,jV=(Qk,Qz,QA)=>(jB(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class jX extends jb{constructor(){super(...arguments),jV(this,'videoCtx');}async['load'](Qk){if(!(this['loaded']||!(Qk instanceof jU)||!Qk['videoCtx']))return this['videoCtx']=Qk['videoCtx'],super['load'](Qk);}['unload'](){this['loaded']&&(delete this['videoCtx'],super['unload']());}}var jn=Object['defineProperty'],jq=Object['getOwnPropertySymbols'],Q0=Object['prototype']['hasOwnProperty'],Q1=Object['prototype']['propertyIsEnumerable'],Q2=(Qk,Qz,QA)=>Qz in Qk?jn(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,Q3=(Qk,Qz)=>{for(var QA in Qz||(Qz={}))Q0['call'](Qz,QA)&&Q2(Qk,QA,Qz[QA]);if(jq){for(var QA of jq(Qz))Q1['call'](Qz,QA)&&Q2(Qk,QA,Qz[QA]);}return Qk;},Q4=(Qk,Qz,QA)=>(Q2(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class Q5 extends jb{constructor(Qk,Qz,QA,QG){super(),this['inputs']=Qk,this['uniforms']=Qz,this['fragSrc']=QA,this['vertSrc']=QG,Q4(this,'shader'),Q4(this,'size',{'width':0x0,'height':0x0});}async['load'](Qk){if(!(this['loaded']||!(Qk instanceof jg)||!Qk['shaderCtx']))return this['shader']=new jP(Qk['shaderCtx'],this['size'],this['inputs'],this['uniforms'],this['fragSrc'],this['vertSrc']),super['load'](Qk);}['unload'](){var Qk;this['loaded']&&((Qk=this['shader'])==null||Qk['dispose'](),delete this['shader'],super['unload']());}async['update'](Qk,Qz){var QA,QG;const {renderer:Qc}=this;if(!this['loaded']||!(Qc instanceof jg)||!Qc['current'])return;const QU=await this['process'](Qk,Qc['current'])&&((QG=(QA=this['shader'])==null?void 0x0:QA['output'])==null?void 0x0:QG['texture']());QU&&(Qc['current']=QU);}async['process'](Qk,Qz){var QA;return(QA=this['shader'])==null||QA['process']([Qz]),!0x0;}['setupVideo'](Qk){var Qz;this['size']=Q3({},Qk),(Qz=this['shader'])==null||Qz['resize'](Qk);}}var Q6=Object['defineProperty'],Q7=(Qk,Qz,QA)=>Qz in Qk?Q6(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,Q8=(Qk,Qz,QA)=>(Q7(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class Q9 extends jb{constructor(){super(...arguments),Q8(this,'scene');}async['load'](Qk){if(!(this['loaded']||!(Qk instanceof jF)||!Qk['scene']))return this['scene']=Qk['scene'],super['load'](Qk);}['unload'](){this['loaded']&&(delete this['scene'],super['unload']());}}class Qj{constructor(Qk,Qz=!0x1,QA='video',QG){this['renderer']=Qk,this['mirror']=Qz,this['sizeMode']=QA,this['sizeMax']=QG;}async['snapshot'](){return new Promise(Qk=>{this['renderer']['once']('render',()=>{const {renderer:Qz}=this,{layers:QA}=Qz['canvas'];let {width:QG,height:Qc}=Qz['canvas']['layers'][0x0];this['sizeMode']==='max'?(QG=Math['max'](...QA['map'](QT=>QT['width'])),Qc=Math['max'](...QA['map'](QT=>QT['height']))):this['sizeMode']==='min'&&(QG=Math['min'](...QA['map'](QT=>QT['width'])),Qc=Math['min'](...QA['map'](QT=>QT['height'])));const QU=document['createElement']('canvas');QU['id']='engeenee.snapshot',QU['hidden']=!0x0,QU['width']=QG,QU['height']=Qc;const Ql=QU['getContext']('2d',{'alpha':!0x0});if(!Ql)return;this['mirror']&&(Ql['translate'](QG,0x0),Ql['scale'](-0x1,0x1)),QA['forEach'](QT=>Ql['drawImage'](QT,0x0,0x0,QG,Qc));const QC=Ql['getImageData'](0x0,0x0,QG,Qc);QU['remove'](),Qk(QC);});});}async['snapshotLayers'](){return new Promise(Qk=>{this['renderer']['once']('render',()=>{const Qz=document['createElement']('canvas');Qz['id']='engeenee.snapshot',Qz['hidden']=!0x0;const QA=Qz['getContext']('2d',{'alpha':!0x0});if(!QA)return;const QG=this['renderer']['canvas']['layers']['map'](Qc=>{const {width:QU,height:Ql}=Qc;return Qz['width']=QU,Qz['height']=Ql,QA['resetTransform'](),this['mirror']&&(QA['translate'](QU,0x0),QA['scale'](-0x1,0x1)),QA['drawImage'](Qc,0x0,0x0),QA['getImageData'](0x0,0x0,QU,Ql);});Qz['remove'](),Qk(QG);});});}}var QQ=Object['defineProperty'],Qt=(Qk,Qz,QA)=>Qz in Qk?QQ(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,Qm=(Qk,Qz,QA)=>(Qt(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class QW{constructor(Qk,Qz='video/webm',QA=!0x1,QG='video',Qc,QU){this['renderer']=Qk,this['type']=Qz,this['mirror']=QA,this['sizeMode']=QG,this['sizeMax']=Qc,this['bitRate']=QU,Qm(this,'canvas'),Qm(this,'context',null),Qm(this,'stream'),Qm(this,'recorder'),Qm(this,'records',[]),Qm(this,'frame',()=>{var Ql;const {renderer:QC,context:QT,stream:Qp}=this,{width:Qo,height:Qu}=this['canvas'];!Qp||!QT||(QC['canvas']['layers']['map'](QN=>QT['drawImage'](QN,0x0,0x0,Qo,Qu)),(Ql=Qp['getVideoTracks']()[0x0])==null||Ql['requestFrame']());}),this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}['start'](){const {canvas:Qk,context:Qz,renderer:QA}=this;if(!Qk||!Qz)return!0x1;const {layers:QG}=QA['canvas'];let {width:Qc,height:QU}=QG[0x0];this['sizeMode']==='max'?(Qc=Math['max'](...QG['map'](QC=>QC['width'])),QU=Math['max'](...QG['map'](QC=>QC['height']))):this['sizeMode']==='min'&&(Qc=Math['min'](...QG['map'](QC=>QC['width'])),QU=Math['min'](...QG['map'](QC=>QC['height'])));const Ql=Math['max'](Qc,QU);if(this['sizeMax']&&Ql>this['sizeMax']){const QC=this['sizeMax']/Ql;Qc*=QC,QU*=QC;}return Qk['width']=Qc,Qk['height']=QU,Qz['resetTransform'](),this['mirror']&&(Qz['translate'](Qc,0x0),Qz['scale'](-0x1,0x1)),QA['on']('render',this['frame']),this['records']=[],this['stream']=Qk['captureStream'](0x0),this['recorder']=new MediaRecorder(this['stream'],{'mimeType':this['type'],'videoBitsPerSecond':this['bitRate']}),this['recorder']['ondataavailable']=QT=>this['records']['push'](QT['data']),this['recorder']['start'](),!0x0;}async['stop'](){const {recorder:Qk}=this;if(!(!Qk||Qk['state']!='recording'))return new Promise(Qz=>{Qk['onstop']=()=>{var QA;Qz(new Blob(this['records'],{'type':this['type']})),this['records']=[],(QA=this['stream'])==null||QA['getVideoTracks']()['forEach'](QG=>QG['stop']()),this['renderer']['removeListener']('render',this['frame']),delete this['stream'],delete this['recorder'];},Qk['stop']();});}['dispose'](){this['canvas']['remove']();}}var Qx=Object['defineProperty'],Qh=(Qk,Qz,QA)=>Qz in Qk?Qx(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,Qd=(Qk,Qz,QA)=>(Qh(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class Qs{constructor(Qk,Qz=0x0,QA='video/webm',QG){this['renderer']=Qk,this['layer']=Qz,this['type']=QA,this['bitRate']=QG,Qd(this,'stream'),Qd(this,'recorder'),Qd(this,'records',[]);}['start'](){const {renderer:Qk}=this,Qz=Qk['canvas']['layers'][this['layer']];return this['records']=[],this['stream']=Qz['captureStream'](),this['recorder']=new MediaRecorder(this['stream'],{'mimeType':this['type'],'videoBitsPerSecond':this['bitRate']}),this['recorder']['ondataavailable']=QA=>this['records']['push'](QA['data']),this['recorder']['start'](),!0x0;}async['stop'](){const {recorder:Qk}=this;if(!(!Qk||Qk['state']!='recording'))return new Promise(Qz=>{Qk['onstop']=()=>{var QA;Qz(new Blob(this['records'],{'type':this['type']})),this['records']=[],(QA=this['stream'])==null||QA['getVideoTracks']()['forEach'](QG=>QG['stop']()),delete this['stream'],delete this['recorder'];},Qk['stop']();});}}var QD=Object['defineProperty'],QM=(Qk,Qz,QA)=>Qz in Qk?QD(Qk,Qz,{'enumerable':!0x0,'configurable':!0x0,'writable':!0x0,'value':QA}):Qk[Qz]=QA,QI=(Qk,Qz,QA)=>(QM(Qk,typeof Qz!='symbol'?Qz+'':Qz,QA),QA);class QO{constructor(Qk,Qz=!0x1,QA='video',QG){this['renderer']=Qk,this['mirror']=Qz,this['sizeMode']=QA,this['sizeMax']=QG,QI(this,'canvas'),QI(this,'context',null),QI(this,'stream'),QI(this,'render',()=>{const {canvas:Qc,context:QU}=this;!Qc||!QU||this['renderer']['canvas']['layers']['map'](Ql=>QU['drawImage'](Ql,0x0,0x0,Qc['width'],Qc['height']));}),this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['mirror']&&(this['canvas']['style']['transform']='scaleX(-1)'),this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}['start'](){const {canvas:Qk,context:Qz,renderer:QA}=this;if(!Qk||!Qz)return!0x1;const {layers:QG}=QA['canvas'];let {width:Qc,height:QU}=QG[0x0];this['sizeMode']==='max'?(Qc=Math['max'](...QG['map'](QC=>QC['width'])),QU=Math['max'](...QG['map'](QC=>QC['height']))):this['sizeMode']==='min'&&(Qc=Math['min'](...QG['map'](QC=>QC['width'])),QU=Math['min'](...QG['map'](QC=>QC['height'])));const Ql=Math['max'](Qc,QU);if(this['sizeMax']&&Ql>this['sizeMax']){const QC=this['sizeMax']/Ql;Qc*=QC,QU*=QC;}return Qk['width']=Qc,Qk['height']=QU,Qz['resetTransform'](),this['mirror']&&(Qz['translate'](Qc,0x0),Qz['scale'](-0x1,0x1)),this['renderer']['on']('render',this['render']),this['stream']=Qk['captureStream'](),!0x0;}['pause'](){this['renderer']['removeListener']('render',this['render']);}['mediaStream'](){return this['stream'];}}export{jz as CanvasRenderer,b as Engine,t as EventEmitterT,u as ImageBuffer,jp as ImageTexture,jb as Plugin,jM as PluginRenderer,j4 as Processor,QW as Recorder,jh as Renderer,j8 as ResponsiveCanvas,Q9 as ScenePlugin,jF as SceneRenderer,Q5 as ShaderPlugin,jP as ShaderProgram,jg as ShaderRenderer,Qj as Snapshoter,QO as Streamer,Qs as UniRecorder,w as VideoCapture,jX as VideoPlugin,jU as VideoRenderer,N as VideoSource};
